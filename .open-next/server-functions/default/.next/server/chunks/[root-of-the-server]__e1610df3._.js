module.exports=[46786,(t,e,r)=>{e.exports=t.x("os",()=>require("os"))},12714,(t,e,r)=>{e.exports=t.x("node:fs/promises",()=>require("node:fs/promises"))},27699,(t,e,r)=>{e.exports=t.x("events",()=>require("events"))},874,(t,e,r)=>{e.exports=t.x("buffer",()=>require("buffer"))},22734,(t,e,r)=>{e.exports=t.x("fs",()=>require("fs"))},88947,(t,e,r)=>{e.exports=t.x("stream",()=>require("stream"))},67808,t=>{"use strict";var e,r,a,o,i=t.i(59485);class AbortSignal{onabort=null;_aborted=!1;constructor(){Object.defineProperty(this,"_aborted",{value:!1,writable:!0})}get aborted(){return this._aborted}abort(){this._aborted=!0,this.onabort&&(this.onabort(this),this.onabort=null)}}class s{signal=new AbortSignal;abort(){this.signal.abort()}}let n=async t=>{let e=t?.Bucket||"";if("string"==typeof t.Bucket&&(t.Bucket=e.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"))),p(e)){if(!0===t.ForcePathStyle)throw Error("Path-style addressing cannot be used with ARN buckets")}else c(e)&&(-1===e.indexOf(".")||String(t.Endpoint).startsWith("http:"))&&e.toLowerCase()===e&&!(e.length<3)||(t.ForcePathStyle=!0);return t.DisableMultiRegionAccessPoints&&(t.disableMultiRegionAccessPoints=!0,t.DisableMRAP=!0),t},l=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,u=/(\d+\.){3}\d+/,d=/\.\./,c=t=>l.test(t)&&!u.test(t)&&!d.test(t),p=t=>{let[e,r,a,,,o]=t.split(":"),i="arn"===e&&t.split(":").length>=6,s=!!(i&&r&&a&&o);if(i&&!s)throw Error(`Invalid ARN: ${t} was an invalid ARN.`);return s},h=(t,e,r)=>{let a=async()=>{let a=r[t]??r[e];return"function"==typeof a?a():a};return"credentialScope"===t||"CredentialScope"===e?async()=>{let t="function"==typeof r.credentials?await r.credentials():r.credentials;return t?.credentialScope??t?.CredentialScope}:"accountId"===t||"AccountId"===e?async()=>{let t="function"==typeof r.credentials?await r.credentials():r.credentials;return t?.accountId??t?.AccountId}:"endpoint"===t||"endpoint"===e?async()=>{if(!1===r.isCustomEndpoint)return;let t=await a();if(t&&"object"==typeof t){if("url"in t)return t.url.href;if("hostname"in t){let{protocol:e,hostname:r,port:a,path:o}=t;return`${e}//${r}${a?":"+a:""}${o}`}}return t}:a};class f extends Error{name="ProviderError";tryNextLink;constructor(t,e=!0){let r,a=!0;"boolean"==typeof e?(r=void 0,a=e):null!=e&&"object"==typeof e&&(r=e.logger,a=e.tryNextLink??!0),super(t),this.tryNextLink=a,Object.setPrototypeOf(this,f.prototype),r?.debug?.(`@smithy/property-provider ${a?"->":"(!)"} ${t}`)}static from(t,e=!0){return Object.assign(new this(t.message,e),t)}}class m extends f{name="CredentialsProviderError";constructor(t,e=!0){super(t,e),Object.setPrototypeOf(this,m.prototype)}}function y(t){try{let e=new Set(Array.from(t.match(/([A-Z_]){3,}/g)??[]));return e.delete("CONFIG"),e.delete("CONFIG_PREFIX_SEPARATOR"),e.delete("ENV"),[...e].join(", ")}catch(e){return t}}var g=t.i(14747);(e=a||(a={})).PROFILE="profile",e.SSO_SESSION="sso-session",e.SERVICES="services";let b=t=>Object.entries(t).filter(([t])=>{let e=t.indexOf(".");return -1!==e&&Object.values(a).includes(t.substring(0,e))}).reduce((t,[e,r])=>{let o=e.indexOf(".");return t[e.substring(0,o)===a.PROFILE?e.substring(o+1):e]=r,t},{...t.default&&{default:t.default}});var C=t.i(46786);let E={},S=()=>{let{HOME:t,USERPROFILE:e,HOMEPATH:r,HOMEDRIVE:a=`C:${g.sep}`}=process.env;if(t)return t;if(e)return e;if(r)return`${a}${r}`;let o=process&&process.geteuid?`${process.geteuid()}`:"DEFAULT";return E[o]||(E[o]=(0,C.homedir)()),E[o]},_=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,P=["__proto__","profile __proto__"],w=t=>{let e,r,o={};for(let i of t.split(/\r?\n/)){let t=i.split(/(^|\s)[;#]/)[0].trim();if("["===t[0]&&"]"===t[t.length-1]){e=void 0,r=void 0;let o=t.substring(1,t.length-1),i=_.exec(o);if(i){let[,t,,r]=i;Object.values(a).includes(t)&&(e=[t,r].join("."))}else e=o;if(P.includes(o))throw Error(`Found invalid profile name "${o}"`)}else if(e){let a=t.indexOf("=");if(![0,-1].includes(a)){let[s,n]=[t.substring(0,a).trim(),t.substring(a+1).trim()];if(""===n)r=s;else{r&&i.trimStart()===i&&(r=void 0),o[e]=o[e]||{};let t=r?[r,s].join("."):s;o[e][t]=n}}}}return o};var v=t.i(12714);let A={},R={},U=(t,e)=>void 0!==R[t]?R[t]:((!A[t]||e?.ignoreCache)&&(A[t]=(0,v.readFile)(t,"utf8")),A[t]),k=()=>({}),B=async(t={})=>{let{filepath:e=process.env.AWS_SHARED_CREDENTIALS_FILE||(0,g.join)(S(),".aws","credentials"),configFilepath:r=process.env.AWS_CONFIG_FILE||(0,g.join)(S(),".aws","config")}=t,a=S(),o=e;e.startsWith("~/")&&(o=(0,g.join)(a,e.slice(2)));let i=r;r.startsWith("~/")&&(i=(0,g.join)(a,r.slice(2)));let s=await Promise.all([U(i,{ignoreCache:t.ignoreCache}).then(w).then(b).catch(k),U(o,{ignoreCache:t.ignoreCache}).then(w).catch(k)]);return{configFile:s[0],credentialsFile:s[1]}},I="AWS_ENDPOINT_URL",N="endpoint_url",T=async t=>{let e;return(({environmentVariableSelector:t,configFileSelector:e,default:r},a={})=>{var o;let i,s,n,l,u,{signingName:d,logger:c}=a;return o=((...t)=>async()=>{let e;if(0===t.length)throw new f("No providers in chain");for(let r of t)try{return await r()}catch(t){if(e=t,t?.tryNextLink)continue;throw t}throw e})((i={signingName:d,logger:c},async()=>{try{let e=t(process.env,i);if(void 0===e)throw Error();return e}catch(e){throw new m(e.message||`Not found in ENV: ${y(t.toString())}`,{logger:i?.logger})}}),((t,{preferredFile:e="config",...r}={})=>async()=>{let a=r.profile||process.env.AWS_PROFILE||"default",{configFile:o,credentialsFile:i}=await B(r),s=i[a]||{},n=o[a]||{},l="config"===e?{...s,...n}:{...n,...s};try{let r="config"===e?o:i,a=t(l,r);if(void 0===a)throw Error();return a}catch(e){throw new m(e.message||`Not found in config files w/ profile [${a}]: ${y(t.toString())}`,{logger:r.logger})}})(e,a),(t=>"function"==typeof t?async()=>await t():()=>Promise.resolve(t))(r)),u=async()=>{n||(n=o());try{s=await n,l=!0}finally{n=void 0}return s},async t=>((!l||t?.forceRefresh)&&(s=await u()),s)})((e=t??"",{environmentVariableSelector:t=>{let r=t[[I,...e.split(" ").map(t=>t.toUpperCase())].join("_")];if(r)return r;let a=t[I];if(a)return a},configFileSelector:(t,r)=>{if(r&&t.services){let a=r[["services",t.services].join(".")];if(a){let t=a[[e.split(" ").map(t=>t.toLowerCase()).join("_"),N].join(".")];if(t)return t}}let a=t[N];if(a)return a},default:void 0}))()},$=t=>{let e;if("string"==typeof t)return $(new URL(t));let{hostname:r,pathname:a,port:o,protocol:i,search:s}=t;return s&&(e=function(t){let e={};if(t=t.replace(/^\?/,""))for(let r of t.split("&")){let[t,a=null]=r.split("=");t=decodeURIComponent(t),a&&(a=decodeURIComponent(a)),t in e?Array.isArray(e[t])?e[t].push(a):e[t]=[e[t],a]:e[t]=a}return e}(s)),{hostname:r,port:o?parseInt(o):void 0,protocol:i,path:a,query:e}},M=t=>"object"==typeof t?"url"in t?$(t.url):t:$(t),L=async(t,e,r,a)=>{if(!r.isCustomEndpoint){let t;(t=r.serviceConfiguredEndpoint?await r.serviceConfiguredEndpoint():await T(r.serviceId))&&(r.endpoint=()=>Promise.resolve(M(t)),r.isCustomEndpoint=!0)}let o=await O(t,e,r);if("function"!=typeof r.endpointProvider)throw Error("config.endpointProvider is not set.");return r.endpointProvider(o,a)},O=async(t,e,r)=>{let a={},o=e?.getEndpointParameterInstructions?.()||{};for(let[e,i]of Object.entries(o))switch(i.type){case"staticContextParams":a[e]=i.value;break;case"contextParams":a[e]=t[i.name];break;case"clientContextParams":case"builtInParams":a[e]=await h(i.name,e,r)();break;case"operationContextParams":a[e]=i.get(t);break;default:throw Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(i))}return 0===Object.keys(o).length&&Object.assign(a,r),"s3"===String(r.serviceId).toLowerCase()&&await n(a),a};function x(t){return encodeURIComponent(t).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()})}var F=t.i(27699),z=t.i(874),j=t.i(22734);let K={...{lstatSync:()=>{},isFileReadStream:t=>!1},runtime:"node",lstatSync:j.lstatSync,isFileReadStream:t=>t instanceof j.ReadStream},q=t=>{if(null==t)return 0;if("string"==typeof t)return z.Buffer.byteLength(t);if("number"==typeof t.byteLength)return t.byteLength;if("number"==typeof t.length)return t.length;if("number"==typeof t.size)return t.size;if("number"==typeof t.start&&"number"==typeof t.end)return t.end+1-t.start;if(K.isFileReadStream(t))try{return K.lstatSync(t.path).size}catch(t){}};(r=o||(o={})).EMPTY_INPUT="a null or undefined Body",r.CONTENT_LENGTH="the ContentLength property of the params set by the caller",r.STRING_LENGTH="the encoded byte length of the Body string",r.TYPED_ARRAY="the byteLength of a typed byte array such as Uint8Array",r.LENGTH="the value of Body.length",r.SIZE="the value of Body.size",r.START_END_DIFF="the numeric difference between Body.start and Body.end",r.LSTAT="the size of the file given by Body.path on disk as reported by lstatSync";var D=t.i(88947);async function*H(t,e,r){let a=1,o={chunks:[],length:0};for await(let i of r(t))for(o.chunks.push(i),o.length+=i.byteLength;o.length>e;){let t=o.chunks.length>1?z.Buffer.concat(o.chunks):o.chunks[0];yield{partNumber:a,data:t.subarray(0,e)},o.chunks=[t.subarray(e)],o.length=o.chunks[0].byteLength,a+=1}yield{partNumber:a,data:1!==o.chunks.length?z.Buffer.concat(o.chunks):o.chunks[0],lastPart:!0}}async function*W(t,e){let r=1,a=0,o=e;for(;o<t.byteLength;)yield{partNumber:r,data:t.subarray(a,o)},r+=1,o=(a=o)+e;yield{partNumber:r,data:t.subarray(a),lastPart:!0}}async function*G(t){for await(let e of t)z.Buffer.isBuffer(e)||e instanceof Uint8Array?yield e:yield z.Buffer.from(e)}async function*Y(t){let e=t.getReader();try{for(;;){let{done:t,value:r}=await e.read();if(t)return;z.Buffer.isBuffer(r)||r instanceof Uint8Array?yield r:yield z.Buffer.from(r)}}catch(t){throw t}finally{e.releaseLock()}}class Z extends F.EventEmitter{static MIN_PART_SIZE=5242880;MAX_PARTS=1e4;queueSize=4;partSize;leavePartsOnError=!1;tags=[];client;params;totalBytes;totalBytesSource;bytesUploadedSoFar;abortController;concurrentUploaders=[];createMultiPartPromise;abortMultipartUploadCommand=null;uploadedParts=[];uploadEnqueuedPartsCount=0;expectedPartsCount;uploadId;uploadEvent;isMultiPart=!0;singleUploadResult;sent=!1;constructor(t){if(super(),this.queueSize=t.queueSize||this.queueSize,this.leavePartsOnError=t.leavePartsOnError||this.leavePartsOnError,this.tags=t.tags||this.tags,this.client=t.client,this.params=t.params,!this.params)throw Error("InputError: Upload requires params to be passed to upload.");this.totalBytes=this.params.ContentLength??q(this.params.Body),this.totalBytesSource=((t,e)=>{if(null!=e)return o.CONTENT_LENGTH;if(null==t)return o.EMPTY_INPUT;if("string"==typeof t)return o.STRING_LENGTH;if("number"==typeof t.byteLength)return o.TYPED_ARRAY;if("number"==typeof t.length)return o.LENGTH;if("number"==typeof t.size)return o.SIZE;if("number"==typeof t.start&&"number"==typeof t.end)return o.START_END_DIFF;if(K.isFileReadStream(t))try{return K.lstatSync(t.path).size,o.LSTAT}catch(t){}})(this.params.Body,this.params.ContentLength),this.bytesUploadedSoFar=0,this.abortController=t.abortController??new s,this.partSize=t.partSize||Math.max(Z.MIN_PART_SIZE,Math.floor((this.totalBytes||0)/this.MAX_PARTS)),void 0!==this.totalBytes&&(this.expectedPartsCount=Math.ceil(this.totalBytes/this.partSize)),this.__validateInput()}async abort(){this.abortController.abort()}async done(){if(this.sent)throw Error("@aws-sdk/lib-storage: this instance of Upload has already executed .done(). Create a new instance.");return this.sent=!0,await Promise.race([this.__doMultipartUpload(),this.__abortTimeout(this.abortController.signal)])}on(t,e){return this.uploadEvent=t,super.on(t,e)}async __uploadUsingPut(t){let e,r,a;this.isMultiPart=!1;let o={...this.params,Body:t.data},s=this.client.config,n=s.requestHandler,l=n instanceof F.EventEmitter?n:null,u=e=>{this.bytesUploadedSoFar=e.loaded,this.totalBytes=e.total,this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:t.partNumber,Key:this.params.Key,Bucket:this.params.Bucket})};null!==l&&l.on("xhr.upload.progress",u);let d=await Promise.all([this.client.send(new i.PutObjectCommand(o)),s?.endpoint?.()]),c=d[0],p=d[1];if(p||(p=M(await L(o,i.PutObjectCommand,{...s}))),!p)throw Error('Could not resolve endpoint from S3 "client.config.endpoint()" nor EndpointsV2.');null!==l&&l.off("xhr.upload.progress",u);let h=this.params.Key.split("/").map(t=>x(t)).join("/"),f=x(this.params.Bucket),m=(e=p.hostname.startsWith(`${f}.`),r=this.client.config.forcePathStyle,a=p.port?`:${p.port}`:"",r?`${p.protocol}//${p.hostname}${a}/${f}/${h}`:e?`${p.protocol}//${p.hostname}${a}/${h}`:`${p.protocol}//${f}.${p.hostname}${a}/${h}`);this.singleUploadResult={...c,Bucket:this.params.Bucket,Key:this.params.Key,Location:m};let y=q(t.data);this.__notifyProgress({loaded:y,total:y,part:1,Key:this.params.Key,Bucket:this.params.Bucket})}async __createMultipartUpload(){let t=await this.client.config.requestChecksumCalculation();if(!this.createMultiPartPromise){let e={...this.params,Body:void 0};"WHEN_SUPPORTED"===t&&(e.ChecksumAlgorithm=this.params.ChecksumAlgorithm||i.ChecksumAlgorithm.CRC32),this.createMultiPartPromise=this.client.send(new i.CreateMultipartUploadCommand(e)).then(t=>(this.abortMultipartUploadCommand=new i.AbortMultipartUploadCommand({Bucket:this.params.Bucket,Key:this.params.Key,UploadId:t.UploadId}),t))}return this.createMultiPartPromise}async __doConcurrentUpload(t){for await(let e of t){if(this.uploadEnqueuedPartsCount>this.MAX_PARTS)throw Error(`Exceeded ${this.MAX_PARTS} parts in multipart upload to Bucket: ${this.params.Bucket} Key: ${this.params.Key}.`);if(this.abortController.signal.aborted)return;if(1===e.partNumber&&e.lastPart)return await this.__uploadUsingPut(e);if(!this.uploadId){let{UploadId:t}=await this.__createMultipartUpload();if(this.uploadId=t,this.abortController.signal.aborted)return}let t=q(e.data)||0,r=this.client.config.requestHandler,a=r instanceof F.EventEmitter?r:null,o=0,s=(r,a)=>{(Number(a.query.partNumber)||-1)===e.partNumber&&(r.total&&t&&(this.bytesUploadedSoFar+=r.loaded-o,o=r.loaded),this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:e.partNumber,Key:this.params.Key,Bucket:this.params.Bucket}))};null!==a&&a.on("xhr.upload.progress",s),this.uploadEnqueuedPartsCount+=1,this.__validateUploadPart(e);let n=await this.client.send(new i.UploadPartCommand({...this.params,ContentLength:void 0,UploadId:this.uploadId,Body:e.data,PartNumber:e.partNumber}));if(null!==a&&a.off("xhr.upload.progress",s),this.abortController.signal.aborted)return;if(!n.ETag)throw Error(`Part ${e.partNumber} is missing ETag in UploadPart response. Missing Bucket CORS configuration for ETag header?`);this.uploadedParts.push({PartNumber:e.partNumber,ETag:n.ETag,...n.ChecksumCRC32&&{ChecksumCRC32:n.ChecksumCRC32},...n.ChecksumCRC32C&&{ChecksumCRC32C:n.ChecksumCRC32C},...n.ChecksumSHA1&&{ChecksumSHA1:n.ChecksumSHA1},...n.ChecksumSHA256&&{ChecksumSHA256:n.ChecksumSHA256}}),null===a&&(this.bytesUploadedSoFar+=t),this.__notifyProgress({loaded:this.bytesUploadedSoFar,total:this.totalBytes,part:e.partNumber,Key:this.params.Key,Bucket:this.params.Bucket})}}async __doMultipartUpload(){let t,e=((t,e)=>{if(t instanceof Uint8Array)return W(t,e);if(t instanceof D.Readable)return H(t,e,G);if(t instanceof String||"string"==typeof t)return W(z.Buffer.from(t),e);if("function"==typeof t.stream)return H(t.stream(),e,Y);if(t instanceof ReadableStream)return H(t,e,Y);throw Error("Body Data is unsupported format, expected data to be one of: string | Uint8Array | Buffer | Readable | ReadableStream | Blob;.")})(this.params.Body,this.partSize),r=[];for(let t=0;t<this.queueSize;t++){let t=this.__doConcurrentUpload(e).catch(t=>{r.push(t)});this.concurrentUploaders.push(t)}if(await Promise.all(this.concurrentUploaders),r.length>=1)throw await this.markUploadAsAborted(),r[0];if(this.abortController.signal.aborted)throw await this.markUploadAsAborted(),Object.assign(Error("Upload aborted."),{name:"AbortError"});if(this.isMultiPart){let{expectedPartsCount:e,uploadedParts:r,totalBytes:a,totalBytesSource:o}=this;if(void 0!==a&&void 0!==e&&r.length!==e)throw Error(`Expected ${e} part(s) but uploaded ${r.length} part(s).
The expected part count is based on the byte-count of the input.params.Body,
which was read from ${o} and is ${a}.
If this is not correct, provide an override value by setting a number
to input.params.ContentLength in bytes.
`);this.uploadedParts.sort((t,e)=>t.PartNumber-e.PartNumber);let s={...this.params,Body:void 0,UploadId:this.uploadId,MultipartUpload:{Parts:this.uploadedParts}};t=await this.client.send(new i.CompleteMultipartUploadCommand(s)),"string"==typeof t?.Location&&t.Location.includes("%2F")&&(t.Location=t.Location.replace(/%2F/g,"/"))}else t=this.singleUploadResult;return this.abortMultipartUploadCommand=null,this.tags.length&&await this.client.send(new i.PutObjectTaggingCommand({...this.params,Tagging:{TagSet:this.tags}})),t}async markUploadAsAborted(){this.uploadId&&!this.leavePartsOnError&&null!==this.abortMultipartUploadCommand&&(await this.client.send(this.abortMultipartUploadCommand),this.abortMultipartUploadCommand=null)}__notifyProgress(t){this.uploadEvent&&this.emit(this.uploadEvent,t)}async __abortTimeout(t){return new Promise((e,r)=>{t.onabort=()=>{let t=Error("Upload aborted.");t.name="AbortError",r(t)}})}__validateUploadPart(t){let e=q(t.data);if(void 0===e)throw Error(`A dataPart was generated without a measurable data chunk size for part number ${t.partNumber}`);if((1!==t.partNumber||!t.lastPart)&&!t.lastPart&&e!==this.partSize)throw Error(`The byte size for part number ${t.partNumber}, size ${e} does not match expected size ${this.partSize}`)}__validateInput(){if(!this.client)throw Error("InputError: Upload requires a AWS client to do uploads with.");if(this.partSize<Z.MIN_PART_SIZE)throw Error(`EntityTooSmall: Your proposed upload part size [${this.partSize}] is smaller than the minimum allowed size [${Z.MIN_PART_SIZE}] (5MB)`);if(this.queueSize<1)throw Error("Queue size: Must have at least one uploading queue.")}}let V=process.env.R2_ACCOUNT_ID,X=process.env.R2_ACCESS_KEY_ID,J=process.env.R2_SECRET_ACCESS_KEY,Q=process.env.R2_BUCKET_NAME,tt=process.env.R2_PUBLIC_URL;V&&X&&J&&Q||console.error("Missing R2 environment variables. Please check your .env file.");let te=new i.S3Client({region:"auto",endpoint:`https://${V}.r2.cloudflarestorage.com`,credentials:{accessKeyId:X||"",secretAccessKey:J||""}});async function tr(t,e,r){if(!V||!X||!J||!Q)throw Error("R2 credentials are missing. Please check R2_ACCOUNT_ID, R2_ACCESS_KEY_ID, R2_SECRET_ACCESS_KEY, and R2_BUCKET_NAME in your .env file.");let a=Date.now(),o=Math.random().toString(36).substring(7),i=e.split(".").pop(),s=`properties/${a}-${o}.${i}`,n=new Z({client:te,params:{Bucket:Q,Key:s,Body:t,ContentType:r}});await n.done();let l=tt||"";return l&&!l.startsWith("http")&&(l=`https://${l}`),l&&l.endsWith("/")&&(l=l.slice(0,-1)),{url:`${l}/${s}`,publicId:s,size:t.length}}async function ta(t){let e=new i.DeleteObjectCommand({Bucket:Q,Key:t});await te.send(e)}async function to(t){return Promise.all(t.map(t=>tr(t.buffer,t.filename,t.mimetype)))}t.s(["deleteFromR2",()=>ta,"uploadMultipleToR2",()=>to,"uploadToR2",()=>tr],67808)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__e1610df3._.js.map